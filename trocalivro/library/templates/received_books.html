{% extends "base_generic.html" %}

{% block content %}
{% include "profile_generic.html" %}
<div class="profile-page">
  <h2 class="page-title"> Solicitações recebidas </h2>
  <div class="books-container">
    {% for book_info in user_books %} 
    <div class="user-book">
      <span class="book-request">{{book_info.requester_name}}</span>
      <span>solicitou</span>
      {% if book_info.book.image %}
      <a href="{% url 'book-detail' id=book_info.book.id %}">
          {%load static %}
          <img src="{%static book_info.book.image_display_url %}" alt="{{ book_info.book.title }}">
      </a>
        {% else %}
        <a href="{% url 'book-detail' id=book_info.book.id %}">
          {%load static %}
          <img src="{%static 'images/no-image.png' %}" alt="No image available">
        </a>
        {% endif %}
        <p class="book-title">{{book_info.book.title}}</p>
        <p class="book-author">{{book_info.book.author}}</p>
        {% if book_info.status == 'IN EXCHANGE' %}
        <form method="post" action="{% url 'received-books' %}" class="book-response-form">
          {% csrf_token %}
          <input type="hidden" name="exchange_id" value="{{book_info.exchange_id}}">
          <input type="text" name="message" placeholder="Mensagem (opcional)" class="response-message">
          <div class="response-actions">
            <button type="submit" name="action" value="accept" class="accept-btn">Aceitar</button>
            <button type="submit" name="action" value="reject" class="reject-btn">Recusar</button>
          </div>
        </form>
        {% else %}
        <div class="exchange-status">
          {% if book_info.status == 'UNAVAILABLE' %}
            <span class="status-accepted">✓ Solicitação aceita</span>
          {% elif book_info.status == 'AVAILABLE' %}
            <span class="status-rejected">✗ Solicitação recusada</span>
          {% endif %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
</div>
{% endblock %}
